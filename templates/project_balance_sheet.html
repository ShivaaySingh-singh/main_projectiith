
{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
    .section { margin: 40px auto; max-width: 90%; }

    h2, h4 {
        text-align: center;
        background-color: #dbe7f9;
        padding: 15px;
        font-size: 1.8rem;
        font-weight: bold;
        border-radius: 5px;
    }

    table { border-collapse: collapse !important; width: 100%; font-size: 1.1rem; }

    table th {
        border: 1px solid #000 !important;
        padding: 12px !important;
        font-weight: bold;
        background-color: #f0f0f0;
        text-align: center;
    }

    table td {s
        border: 1px solid #000 !important;
        padding: 10px !important;
        text-align: center;
        font-size: 1.05rem;
    }

    .text-center { text-align: center; }
    .w-75 { width: 75% !important; }
    .w-50 { width: 50% !important; }
    .my-3 { margin-top: 1rem; margin-bottom: 1rem; }
    .fw-bold { font-weight: bold; }

    @media print {
        @page { size: A4; margin: 20mm; }
        .btn-print, .back-btn { display: none !important; }
        header, footer, .portal-title { display: none !important; }
        table { page-break-inside: avoid; }
        body { font-size: 13px; }
    }

    .btn-print {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
    }
    .btn-print:hover { background: #3e8e41; }
</style>

<h2>BALANCE SHEET – PROJECT</h2>

<div class="text-center my-3">
    <a href="{% url 'dashboard' %}" class="btn btn-secondary back-btn me-2">← Back to Dashboard</a>
    <button type="button" onclick="window.print()" class="btn-print"> Print / Save as PDF</button>
</div>

<!-- ✅ Project Info -->
<div class="section">
    <table class="table table-bordered w-75 mx-auto">
        <tr><th>PI Name</th><td>{{ project.pi_name|default_if_none:"" }}</td></tr>
        <tr><th>Department</th><td>{{ project.dept|default_if_none:"" }}</td></tr>
        <tr><th>Project Title</th><td>{{ project.project_title|default_if_none:"" }}</td></tr>
        <tr><th>Project No.</th><td>{{ project.project_no|default_if_none:"" }}</td></tr>
        <tr><th>Short No.</th><td>{{ project.project_short_no|default_if_none:"" }}</td></tr>

        <tr><th>Start Date</th><td>{{ project.project_start_date|date:"d-m-Y" }}</td></tr>
        <tr><th>End Date</th><td>{{ project.project_end_date|date:"d-m-Y" }}</td></tr>

        <tr><th>Sanction Amount</th><td><strong>{{ project.sanction_amount }}</strong></td></tr>
        <tr><th>Recurring</th><td>{{ project.total_recurring }}</td></tr>
        <tr><th>Non-Recurring</th><td>{{ project.total_non_recurring }}</td></tr>

        {% if project.is_extended %}
            <tr><th>Extended End Date</th><td>{{ project.extended_end_date|date:"d-m-Y" }}</td></tr>
            <tr><th>Extension Approved By</th><td>{{ project.extension_approved_by|default:"-" }}</td></tr>
            <tr><th>Extension Reason</th><td>{{ project.extension_reason|default:"-" }}</td></tr>
        {% endif %}
    </table>
</div>

<!-- ✅ Budget Summary (Dynamic Years) -->
<div class="section">
    <h4>Budget (Year-wise)</h4>

    <table class="table table-bordered w-75 mx-auto">
        <thead>
            <tr>
                {% for year, amt in year_budget_list %}
                    <th>Year {{ year }}</th>
                {% endfor %}
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                {% for year, amt in year_budget_list %}
                    <td>{{ amt }}</td>
                {% endfor %}
                <td><strong>{{ total_budget }}</strong></td>
            </tr>
        </tbody>
    </table>
</div>

<!-- ✅ Detailed Budget (Headwise Total) -->
<div class="section">
    <h4>Detailed Budget (Head-wise)</h4>
    <table class="table table-bordered w-100 mx-auto">
        <thead>
            <tr>
                <th>S.No.</th>
                <th>Sanction Head</th>
                <th>Amount</th>
                <th>Expenditure</th>
                <th>Commitment</th>
                <th>Balance</th>
            </tr>
        </thead>
        <tbody>
            {% for row in report_rows %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ row.head }}</td>
                <td>{{ row.sanction }}</td>
                <td>{{ row.expenditure }}</td>
                <td>{{ row.commitment }}</td>
                <td>{{ row.balance }}</td>
            </tr>
            {% endfor %}

            <tr class="fw-bold table-secondary">
                <td colspan="2">Total</td>
                <td>{{ totals.budget }}</td>
                <td>{{ totals.expenditure }}</td>
                <td>{{ totals.commitment }}</td>
                <td>{{ totals.balance }}</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- ✅ Budget Footer -->
<div class="section">
    <table class="table table-bordered w-50 mx-auto">
        <tr><th>Budget</th><td>{{ totals.budget }}</td></tr>
        <tr><th>Expenditure</th><td>{{ totals.expenditure }}</td></tr>
        <tr><th>Commitment</th><td>{{ totals.commitment }}</td></tr>
        <tr><th>Balance</th><td><strong>{{ totals.balance }}</strong></td></tr>
    </table>
</div>

<!-- ✅ Expenditure Details -->
<div class="section">
    <h4>Expenditure</h4>
    <table class="table table-bordered w-100 mx-auto">
        <thead>
            <tr>
                <th>S.No.</th>
                <th>Date</th>
                <th>Voucher No</th>
                <th>Head</th>
                <th>Particulars</th>
                <th>Amount (₹)</th>
                <th>Remarks</th>
            </tr>
        </thead>
        <tbody>
            {% for exp in expenditures %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ exp.date|date:"d-m-Y" }}</td>
                <td>{{ exp.voucher_no|default:"-" }}</td>
                <td>{{ exp.head }}</td>
                <td>{{ exp.particulars }}</td>
                <td>{{ exp.amount }}</td>
                <td>{{ exp.remarks|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="7">No expenditure records found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ✅ Commitment Details -->
<div class="section">
    <h4>Commitment</h4>
    <table class="table table-bordered w-100 mx-auto">
        <thead>
            <tr>
                <th>S.No.</th>
                <th>Date</th>
                <th>Voucher No</th>
                <th>Head</th>
                <th>Particulars</th>
                <th>Amount (₹)</th>
                <th>Remarks</th>
            </tr>
        </thead>
        <tbody>
            {% for com in commitments %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ com.date|date:"d-m-Y" }}</td>
                <td>{{ com.voucher_no|default:"-" }}</td>
                <td>{{ com.head }}</td>
                <td>{{ com.particulars }}</td>
                <td>{{ com.gross_amount }}</td>
                <td>{{ com.remarks|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="7">No commitment records found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
setInterval(function() {
    location.reload();
}, 30000);
</script>

{% endblock %}
